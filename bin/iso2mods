#!/bin/bash
d=tmp
for fn in $d/*.mef; do
  unzip -qo $fn -d $d
  uuid=$(basename $fn .mef)
  echo "Transforming $uuid -> content/descMetadata_$uuid.xml"
  xsltproc lib/geomdtk/iso2mods.xsl $d/$uuid/metadata/metadata.xml > content/descMetadata_$uuid.xml
done

find $d -name '*.shp.xml' | while read fn; do
  f=$d/$(basename $fn .shp.xml | tr / _ | tr A-Z a-z)_iso19139.xml
  echo "Transforming $fn -> $f"
  xsltproc lib/geomdtk/ArcGIS2ISO19139.xslt $fn > $f
done

find $d -name '*_iso19139.xml' | while read fn; do
  f=content/descMetadata_$(basename $fn _iso19139.xml).xml
  echo "Transforming $fn -> $f"
  xsltproc lib/geomdtk/iso2mods.xsl $fn > $f
done
